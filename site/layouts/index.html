{{ define "main" }}

<h1 class="text-4xl font-bold mb-4">Pez's Labs</h1>

<p class="mb-8 text-gray-700 leading-relaxed">
  An archive of random projects, experiments, and things I've built or have worked on over the years.
  <br>
  Most projects (and many that aren't listed here) can also be found on my
  <a href="https://github.com/pezmc/" class="text-blue-600 hover:text-blue-800 underline">GitHub</a>.
</p>

{{ $allPages := .Pages }}
{{ $ongoingPages := where $allPages ".Params.ongoing" true }}
{{ $datedPages := where $allPages ".Params.ongoing" "!=" true }}

{{ if $ongoingPages }}
  <div class="mb-12">
    <h2 class="text-3xl font-bold mb-4 text-gray-900 border-b-2 border-gray-300 pb-2">Ongoing</h2>
    <ul class="space-y-2 ml-4">
      {{ range $ongoingPages }}
      <li>
        <a href="{{ cond (gt (len .Content) 0) .Permalink (cond (gt (len .Params.link) 0) .Params.link .Params.github  ) }}" class="text-blue-600 hover:text-blue-800 underline">{{.Title}}</a>
        {{if .Params.summary}}<span class="text-gray-600"> - {{.Params.Summary}}</span>{{end}}
      </li>
      {{ end }}
    </ul>
  </div>
{{ end }}

{{ $pages := $datedPages.ByDate.Reverse }}
{{ $grouped := $pages.GroupByDate "2006" }}
{{ $currentYear := now.Year }}
{{ $oldestYear := $currentYear }}
{{ $yearMap := dict }}
{{ range $grouped }}
  {{ $year := int .Key }}
  {{ $yearMap = merge $yearMap (dict .Key .) }}
  {{ if lt $year $oldestYear }}
    {{ $oldestYear = $year }}
  {{ end }}
{{ end }}

{{ range seq $currentYear -1 $oldestYear }}
  {{ $year := . }}
  {{ $yearKey := printf "%d" $year }}
  {{ $yearGroup := index $yearMap $yearKey }}
  <div class="mb-12">
    <h2 class="text-3xl font-bold mb-4 text-gray-900 border-b-2 border-gray-300 pb-2">{{ $year }}</h2>
    {{ if $yearGroup }}
      <ul class="space-y-2 ml-4">
        {{ range $yearGroup.Pages }}
        <li>
          <a href="{{ cond (gt (len .Content) 0) .Permalink (cond (gt (len .Params.link) 0) .Params.link .Params.github  ) }}" class="text-blue-600 hover:text-blue-800 underline">{{.Title}}</a>
          {{if .Params.summary}}<span class="text-gray-600"> - {{.Params.Summary}}</span>{{end}}
        </li>
        {{ end }}
      </ul>
    {{ else }}
      <p class="text-gray-500 italic ml-4">Nothing here yet, I'm behind on documenting.</p>
    {{ end }}
  </div>
{{ end }}

{{ end }}
